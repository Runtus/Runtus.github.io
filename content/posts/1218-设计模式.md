---
title: è®¾è®¡æ¨¡å¼ - è§‚å¯Ÿè€…æ¨¡å¼ - å‘å¸ƒè®¢é˜…æ¨¡å¼
date: 2021-12-18 16:06:30
tags: ["Javascript"]
---

> è§‚å¯Ÿè€…æ¨¡å¼å’Œå‘å¸ƒè®¢é˜…æ¨¡å¼æ˜¯å¹³å¸¸ä¸šåŠ¡å¼€å‘ä¸­æœ€å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œè™½ç„¶ç½‘ä¸Šå¤§å¤šæ•°æ–‡ç« å°†äºŒè€…å½’ä¸ºä¸€ç±»ï¼Œå…¶å®žä¸ç„¶ï¼Œå®ƒä»¬ä¸¤è€…ä¹‹é—´è¿˜æ˜¯æœ‰ç»†å¾®çš„å·®è·ã€‚

## å…ˆæ¥ä¸ªè§‚å¯Ÿè€…æ¨¡å¼çš„å®šä¹‰

* è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œè®©å¤šä¸ªè§‚å¯Ÿè€…å¯¹è±¡åŒæ—¶ç›‘å¬æŸä¸€ä¸ªç›®æ ‡å¯¹è±¡ï¼Œå½“è¿™ä¸ªç›®æ ‡å¯¹è±¡çš„**æŸä¸ªå±žæ€§ï¼ˆæˆ–çŠ¶æ€ï¼‰**å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡ï¼Œè®©å®ƒä»¬**è‡ªåŠ¨æ›´æ–°**ã€‚

### çŽ°å®žæ˜ å°„

* ä¸¾ä¸€ä¸ªðŸŒ°ï¼Œé«˜ä¸­çš„æ—¶å€™ï¼Œæˆ‘ä¼šç»å¸¸åŽ»é—®è€å¸ˆé—®é¢˜ï¼Œæœ‰æ—¶å€™é‡åˆ°æ¯”è¾ƒéš¾çš„é—®é¢˜ï¼Œè€å¸ˆä¸€æ—¶åŠä¼šè§£ä¸å¼€ï¼Œè€å¸ˆä¼šè¯´**"ä½ å…ˆåŽ»åšå…¶ä»–çš„äº‹æƒ…å§ï¼Œä¸€ä¼šå„¿æˆ‘æ‰¾åˆ°è§£é¢˜æ€è·¯äº†æ¥å«ä½ "**ã€‚äºŽæ˜¯ä¹Žæˆ‘å…ˆåŽ»åšå…¶ä»–äº‹æƒ…ï¼Œç­‰å¾…è€å¸ˆçš„å¬å”¤ã€‚è¿‡äº†ä¸€ä¼šå„¿ï¼Œè€å¸ˆå«å¦ä¸€ä¸ªåŒå­¦æ¥å«æˆ‘åŽ»åŠžå…¬å®¤æ‰¾ä»–ï¼ŒäºŽæ˜¯æˆ‘é©¬ä¸Šæ”¾ä¸‹æ‰‹ä¸­çš„æ´»ï¼Œå†²å‘çš„è€å¸ˆçš„åŠžå…¬å®¤......
* åœ¨è¿™é‡Œä¾‹å­é‡Œï¼Œæˆ‘æ˜¯ä¸€ä½è§‚å¯Ÿè€…ï¼Œè€Œè€å¸ˆåˆ™æ˜¯ä¸€ä½æˆ‘è§‚å¯Ÿçš„å¯¹è±¡ï¼Œå½“è€å¸ˆçš„çŠ¶æ€å‘ç”Ÿäº†å˜åŒ–ï¼ˆæŒ‡æƒ³å‡ºäº†é¢˜çš„æ€è·¯ï¼‰ï¼Œæˆ‘å°±ä¼šæŽ¥å—åˆ°å¯¹åº”çš„ä¿¡æ¯ï¼Œç„¶åŽé©¬ä¸Šæ›´æ–°æˆ‘è‡ªå·±çš„çŠ¶æ€ï¼ˆæŒ‡æ¶¦åŽ»æ‰¾è€å¸ˆï¼‰ã€‚

### æ¥ç‚¹è½¬æ¢

* ä¸Šè¿°ä¾‹å­å¦‚æžœåœ¨````å‘å¸ƒ-è®¢é˜…````æ¨¡å¼é‡Œï¼Œæˆ‘åˆ™æ‘‡èº«ä¸€å˜ï¼Œå˜æˆäº†è®¢é˜…è€…ï¼Œä¸“é—¨è®¢é˜…è€å¸ˆå‘å¸ƒçš„**é€šçŸ¥ä¿¡æ¯**ï¼Œè€Œè€å¸ˆåˆ™ä½œä¸ºäº†**å‘å¸ƒè€…**ã€‚
* å…¶å®žï¼Œä¸Šè¿°ä¾‹å­è¿˜ä¸èƒ½å®Œå…¨å±•ç¤ºå‡ºå®šä¹‰æ‰€è¯´çš„**ä¸€å¯¹å¤šå…³ç³»**ï¼Œå› ä¸ºè®¢é˜…è€…åªæœ‰æˆ‘ä¸€ä¸ªäººï¼Œä½†å…¶å®žç¨å¾®æ‰©å±•ä¸€ä¸‹ï¼Œå˜æˆ**å¤šä½åŒå­¦å‘è€å¸ˆè¯¢é—®åŒä¸€é“é¢˜ç›®**ï¼Œé‚£è¿™å°±æ˜¯æ ‡å‡†çš„**è§‚å¯Ÿè€…æ¨¡å¼**äº†ï¼Œå¤šä½è§‚å¯Ÿè€…â€œè§‚å¯Ÿâ€è€å¸ˆçš„çŠ¶æ€ã€‚

### æ¥ç‚¹ä»£ç 

* é€šè¿‡ä¸Šè¿°çš„å®šä¹‰å’Œæè¿°ï¼Œå¤§æ¦‚å¯ä»¥çŸ¥é“ï¼Œåœ¨è§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼Œä¸€å…±æœ‰**ä¸¤ä¸ªç±»ï¼šå‘å¸ƒè€…ç±»å’Œè®¢é˜…è€…ç±»**ã€‚ä½œä¸ºä¸€ä¸ªå‘å¸ƒè€…ï¼Œå¾ˆå®¹æ˜“å¯ä»¥æƒ³åˆ°å®ƒæœ‰ä¸‹é¢å‡ ä¸ªåŸºæœ¬æ–¹æ³•ï¼š**å¢žåŠ è®¢é˜…è€…ï¼Œé€šçŸ¥è®¢é˜…è€…ï¼Œç§»é™¤è®¢é˜…è€…**ã€‚æ€è·¯æœ‰äº†ï¼Œä¸‹é¢å°±ç›´æŽ¥å®žçŽ°ã€‚

````js
// å‘å¸ƒè€…ç±»
class Publisher {
    constructor() {
        this.observers = []      // Observer -> è§‚å¯Ÿå‘˜
    }

// æ·»åŠ è®¢é˜…è€…
    add(observers) {
        this.observers.push(...observers)
    }
// ç§»é™¤è®¢é˜…è€…
    remove(observer) {
        this.observers.forEach((item, index) => {
            if (item === observer) {
                this.observer.splice(index, 1)
            }
        })
    }
// é€šçŸ¥è®¢é˜…è€…
    notify() {
        this.observers.forEach((item) => {
            item.update(); // æ³¨æ„ï¼Œè®¢é˜…è€…çš„æ–¹æ³•åº”è¯¥å®ƒä»¬æœ¬èº«å®šä¹‰çš„
        })
    }
}


````

* å‘å¸ƒè€…åŸºæœ¬ç±»è®¾è®¡å®Œæ¯•ï¼Œä¸‹é¢å¼€å§‹è®¾è®¡ä¸‹è®¢é˜…è€…ï¼Œå…¶å®žè®¢é˜…è€…å¾ˆç®€å•ï¼Œå®ƒæœ€æ ¸å¿ƒçš„å°±ä¸€ä¸ªæ–¹æ³•ï¼šæ”¶åˆ°å‘å¸ƒè€…çš„ä¿¡æ¯åŽï¼Œ**åŽ»è¿›è¡ŒçŠ¶æ€æ›´æ–°**ã€‚å¦‚ä¸‹æ‰€ç¤ºã€‚

```js
// å®šä¹‰è®¢é˜…è€…ç±»
class Observer {
    constructor() {
        console.log('åˆ›å»ºè®¢é˜…è€…')
    }

    update() {
        console.log('æ›´æ–°çŠ¶æ€')
    }
}


```

* å¥½äº†ï¼Œä¸Šè¿°ä¸¤æ®µä»£ç å°±æ˜¯æœ€åŸºæœ¬çš„è§‚å¯Ÿè€…æ¨¡å¼å®žçŽ°ï¼Œå®žé™…åœºæ™¯çš„è§‚å¯Ÿè€…æ¨¡å¼éƒ½æ˜¯åŸºäºŽä¸Šé¢çš„ä»£ç è¿›è¡Œè¿­ä»£ã€‚æ¯”å¦‚ä¸‹é¢æˆ‘å°†ä¼šæŠŠä¹‹å‰è¯´çš„å®žä¾‹è¿›è¡Œä»£ç å®žçŽ°

```js
// æ•™å¸ˆç±»
class Teachere extends Publisher {
    constructor() {
        super()
        // 
        this.answers = null
        this.observers = []
    }

    getAnswers() {
        return this.answers
    }

    setAnswers(ques) {
        this.answers = answers;
        console.log('è€å¸ˆæƒ³å‡ºäº†ç­”æ¡ˆï¼Œå¿«æ¥åŠžå…¬å®¤æ‰¾è€å¸ˆ')
        this.notify()
    }

    notify() {
        const that = this;
        this.observers.forEach(item => {
            item.update(that)
        })
    }
}

// å­¦ç”Ÿç±»
class Student extends Observer {
    constructor() {
        console.log("æˆ‘æ˜¯å­¦ç”Ÿ")
    }

    update(info) {
        const answer = info.getAnswers()
        // ... è¿›è¡Œç›¸å…³çš„æ›´æ–°æ“ä½œ
    }
}
```



### è§‚å¯Ÿè€…æ¨¡å¼å’Œå‘å¸ƒ-è®¢é˜…æ¨¡å¼çš„åŒºåˆ«

* å…¶å®žåœ¨åˆšæ‰çš„ä¾‹å­ä¸ç®—ä¸¥æ ¼æ„ä¹‰ä¸Šçš„```å‘å¸ƒ-è®¢é˜…```æ¨¡å¼ï¼Œå› ä¸ºå‘å¸ƒ-è®¢é˜…æ¨¡å¼ä¸­ï¼Œå‘å¸ƒè€…å’Œè®¢é˜…è€…äºŒè€…ä¹‹é—´æ˜¯é€æ˜Žçš„ï¼Œå³**å®ƒä»¬æ˜¯å½¼æ­¤æ„Ÿå—ä¸åˆ°å¯¹æ–¹çš„**ï¼Œæ— è®ºæ˜¯å‘å¸ƒäº‹ä»¶ï¼Œè¿˜æ˜¯è®¢é˜…äº‹ä»¶ï¼Œéƒ½æ˜¯äº¤ç»™ä¸€ä¸ª**ç»Ÿä¸€çš„ç®¡ç†ç³»ç»Ÿ**æ¥è¿›è¡Œå¤„ç†çš„ï¼Œè¿™å°±ç±»æ¯”äºŽæ¸¸æˆåŽŸç¥žä¸­çš„**æ¯æ—¥å§”æ‰˜**ä¸€æ ·ï¼Œå§”æ‰˜è€…åœ¨å†’é™©å®¶åä¼šè¿›è¡Œæ¯æ—¥ä»»åŠ¡çš„å§”æ‰˜ï¼Œè€Œæ—…è¡Œè€…-æˆ‘åˆ™ä¼šåŽ»å†’é™©å®¶åä¼šåŽ»**é¢†å–æ¯æ—¥ä»»åŠ¡**ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å½¼æ­¤æ„Ÿå—ä¸åˆ°å¯¹æ–¹ï¼Œè€Œæ˜¯å…¨æƒäº¤ç»™å†’é™©å®¶åä¼šæ¥è¿›è¡Œç®¡ç†çš„ã€‚
* å¦‚æžœæ”¾åˆ°Javascriptä¸–ç•Œä¸­ï¼Œæ— è®ºæ˜¯Vueçš„EventBusè¿˜æ˜¯Nodejsä¸­çš„EventEmitterç±»ï¼Œå®ƒä»¬çš„è®¾è®¡ç†å¿µå°±æ˜¯å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼Œ**å³å‘å¸ƒäº‹ä»¶ - è®¢é˜…äº‹ä»¶**è¿™ä¸€ä¸ªè¿‡ç¨‹ã€‚

```js
// è®¢é˜…äº‹ä»¶
event.on("callTeacher", function(...args){
  
})

// å‘å¸ƒäº‹ä»¶
event.emit('callTeacher', arg1, arg2, arg3, ...args)

```

* å¾ˆæ˜Žæ˜¾ï¼Œå’Œè§‚å¯Ÿè€…æ¨¡å¼ä¸åŒçš„æ˜¯ï¼Œå‘å¸ƒ-è®¢é˜…æ¨¡å¼åˆ™å°†è®¢é˜…è€…å’Œå‘å¸ƒè€…**å®Œå…¨è§£è€¦**ï¼ŒäºŒè€…å†ä¹Ÿæ²¡æœ‰**ç›´æŽ¥å…³è”**ï¼Œå®ƒä»¬çš„ä¸€åˆ‡å¤„ç†éƒ½ç»Ÿä¸€äº¤ç»™**ç¬¬ä¸‰æ–¹å¤„ç†**ã€‚
* ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„EventEmitterå®žçŽ°ï¼Œä¸ºäº†åŠ æ·±å¯¹å‘å¸ƒ-è®¢é˜…æ¨¡å¼çš„è®¤è¯†ã€‚

```js
// å‘å¸ƒ-è®¢é˜…æ¨¡å¼çš„ç®¡ç†ç«™
class EventEmitter {
    constructor() {
        // handlers -> mapï¼Œå­˜å‚¨äº‹ä»¶å’Œå›žè°ƒä¹‹é—´çš„å…³ç³»
        this.handlers = {}
    }

    // eventname -> äº‹ä»¶åç§° , cb -> å“åº”çš„å›žè°ƒå‡½æ•°
    on(eventName, cb) {
        if (!this.handlers[eventName]) {
            this.handlers[eventName] = []
        }

        this.handlers[eventName].push(cb);
    }

    emit(eventName, ...args) {
        if (this.handlers[eventName]) {
           // è¿™é‡Œç”¨æ‹·è´ï¼Œå¦åˆ™onceçš„åˆ é™¤ä¼šå¯¼è‡´handlersçš„forEachéåŽ†å¤±åº
            const handlers = this.handlers[eventName].slice()
            handlers[eventName].forEach(cb => {
                cb(...args)
            })
        }
    }

    off(eventName, cb) {
        if (this.handlers[eventName]) {
            this.handlers[eventName].forEach((item, index) => {
                if (item === cb) {
                    this.handlers[eventName].splice(index, 1)
                }
            })
        }
    }

    // ä¸ºäº‹ä»¶æ³¨å†Œå•æ¬¡ç›‘å¬å™¨
    once(eventName, cb) {
        const wrapper = (...args) => {
            cb(...args)
            this.off(eventName, wrapper)
        }
        this.on(eventName, wrapper)
    }
}
```

